# bookShop

Используемые технологии:

- Java 8
- Maven
- Spring Boot 2.4.5
- Spring Security 5.3.9.RELEASE
- JWT 0.9.1
- Spring Data JPA 2.4.5
- PostgresSQL 42.2.19
- Liquibase 3.10.3
- Springfox 3.0.0
- JAXB 2.3.1
- Selenium 3.141.59
- Twilio 8.14.0
- Spring Boot Mail 2.5.0
- Spring Boot Actuator 2.5.0
- Spring Boot Admin Client 2.4.1
- Spring Boot OAuth2 client 2.5.0
- Apache Commons-io 1.3.2
- Thymeleaf 2.4.5
- Html5
- CSS
- JQery

## Настройки приложения:
### Изменить настройки вы можете в файле MyBookShopApp\src\main\resources\application.properties

Для подключении базы данных необходимо установить настройки: 


_spring.datasource.url={url}_ <br>
_spring.datasource.username={name}_ <br>
_spring.datasource.password={pass}_ <br>
_spring.datasource.driver-class-name={driver}_ <br>
_spring.jpa.database-platform={dialect}_ <br>

База данных инициализируется при запуске приложения с помощью Liquibase, в resources/db/changelog для каждой сущности находится пакет с changeSet b SQL-скриптами.

Приложение интегрировано с Google Book API и для использования строки поиска необходимо установить следующие свойство:

_google.books.api.key={your key}_

При регистрации нового пользователя на указанные e-mail и номер телефона отсылаются одноразовые коды для подтверждения указанных данных. Аутентификация пользователя проходит одним из предложенных способов, через e-mail или через номер телефона, на которые так же отправляется одноразовый код. <br>
Для отправки одноразовых кодов необходимо установить следующие настройки:

Для телефона:

_twilio.ACCOUNT_SID={your account}_ <br>
_twilio.AUTH_TOKEN={your token}_ <br>
_twilio.TWILIO_NUMBER={your number}_ <br>

Для e-mail:

_appEmail.email={your email}_ <br>
_appEmail.password={your password}_ <br>

Для пополнения счета пользователя приложение интегрированно с платежным сервисом Robocassa, настройки для работы с сервисом в тестовом режиме:

_robokassa.merchant.login={your login}_ <br>
_robokassa.pass.first.test={your password}_

Установка пути хранения обложек книг:

_upload.book-image.path={path}_

Установка пути хранения обложек авторов:

_upload.author-photo.path={path}_

Установка пути хранения файлов книг:

_download.path={path}_

## Запуск приложения

#### Для Windows
Запуск из командной строки из корневой папки: <br>
mvnw spring-boot:run для Windows

Создание и запуск jar файла: <br>
mvnw clean -Dmaven.test.skip package <br>
cd target <br>
java -jar MyBookShopApp-0.0.1.jar

#### Для Linux
Запуск из командной строки из корневой папки: <br>
mvn spring-boot:run для Windows

Создание и запуск jar файла: <br>
mvn clean -Dmaven.test.skip package <br>
java -jar */MyBookShopApp-0.0.1.jar

## Описание

Неаутентифицированному пользователю присваевается роль 'ANONYMOUS', пользователи с этой ролью имеют возможность:

- просматривать основные разделы магазина, такие как: "Главная", "Жанры", "Новинки", "Популярное", "Авторы"
- получить обратную связь в разделе "Контакты", заполнив форму и отправив сообщение 
- пользоваться строкой поиска 
- добавлять книги в корзину и удалять их из нее
- откладывать книги в раздел "Отложеное" и удалять их из этого раздела

После регистрации пользователю устанавливается роль 'USER', пользователи с этой ролью имеют возможноси 'ANONYMOUS', а так же добавляютя следующие:
- просматривать недавно просмотренные книги в разделе "Просмотренные"
- просматривать купленные книги в разделе "Мои книги"
- производить покупку книг
- на странице книге:
  - оценивать книгу
  - оставлять отзывы о книге
  - оценивать отзывы других пользователей
  - скачать книгу если она куплена
  - переместить книгу в архив если она куплена
- просматривать раздел "Профиль", где возможно:
  - изменять свои учетные данные
  - просматривать историю транзакций
  - пополнять счет

Пользователи с ролью 'ADMIN', помимо выше перечисленных имеют возможности:
- на странице книге:
  - редактировать описание книги
  - изменять обложку книги 
  - удалять отзывы о книге
  - удалять саму книгу
- на странице автора:
  - редактировать описание автора
  - изменять фото автора
- просматривать разделы "Новая книга" и "Пользователи"
- в разделе "Новая книга"  добавлять новую книгу, при заполнении формы если книга имеет несколько авторов, жанров или тэгов то они записываются через запятую и пробел и если указанных атрибутов нет в базе данных то они так же добавляются. Все поля в форме кроме 'Discount %' должны быть заполнены. Тип файла для книги допускается только с расширением .pdf, .epub или .fb2
- в разделе "Пользователи" просматривать всех пользователей, при нажатии на "Подробнее" открывается страница с данным пользователем
- на странице пользователя:
  - посмотреть данные пользователя
  - посмотреть купленные книги пользователем
  - сделать подарок пользователю. На сранице показаны 10 рекомендуемых книг для этого пользователя в подразделе "подарить книгу пользователю", при нажатии на одну из них книга добавляется пользователю 
  - добавить пользователю роль 'ADMIN' если у пользователя нет данной роли
  - удалить роль 'ADMIN' если у пользователя есть данная роль
  - заблокировать пользователя на 3 или 24 часа
  - удалить пользователя